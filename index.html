<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞-–∫–≤–∏–∑</title>
  <style>
    :root {
      --bg-a: #ff9aa8;
      --bg-b: #ffd36e;
      --bg-c: #ffb56b;
      --text-main: #542028;
      --text-soft: #724049;
      --card-bg: rgba(255, 255, 255, 0.88);
      --accent: #ff476a;
      --accent-hover: #e73a5c;
      --btn-dark: #2b2b30;
      --soft-border: rgba(84, 32, 40, 0.14);
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      min-height: 100%;
    }

    body {
      min-height: 100svh;
      padding:
        max(16px, env(safe-area-inset-top))
        max(16px, env(safe-area-inset-right))
        max(20px, env(safe-area-inset-bottom))
        max(16px, env(safe-area-inset-left));
      display: grid;
      place-items: center;
      overflow: hidden;
      position: relative;
      font-family: "Avenir Next", "Trebuchet MS", "Gill Sans", sans-serif;
      color: var(--text-main);
      background: linear-gradient(120deg, var(--bg-a), var(--bg-b), var(--bg-c), var(--bg-a));
      background-size: 300% 300%;
      animation: gradientShift 12s ease-in-out infinite;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background:
        radial-gradient(circle at 20% 25%, rgba(255, 255, 255, 0.35), transparent 40%),
        radial-gradient(circle at 80% 75%, rgba(255, 255, 255, 0.25), transparent 45%);
      pointer-events: none;
      z-index: 0;
    }

    .hearts-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }

    .heart {
      position: absolute;
      bottom: -12vh;
      opacity: 0;
      font-size: clamp(20px, 5vw, 32px);
      filter: drop-shadow(0 4px 10px rgba(0, 0, 0, 0.14));
      animation-name: floatUp;
      animation-timing-function: linear;
      animation-fill-mode: forwards;
      transform: translateX(0);
    }

    .card {
      position: relative;
      z-index: 1;
      width: min(94vw, 460px);
      max-height: min(88svh, 840px);
      border-radius: 28px;
      padding: 24px 20px;
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      box-shadow:
        0 18px 50px rgba(69, 17, 28, 0.23),
        inset 0 1px 0 rgba(255, 255, 255, 0.7);
      overflow: auto;
      overscroll-behavior: contain;
    }

    .card-inner {
      display: grid;
      gap: 14px;
      animation: fadeIn 280ms ease;
    }

    .screen-center {
      text-align: center;
    }

    .main-emoji {
      font-size: clamp(64px, 18vw, 90px);
      line-height: 1;
      margin-bottom: 4px;
      animation: popIn 650ms cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    .intro-title {
      margin: 0;
      font-size: clamp(24px, 6vw, 34px);
      line-height: 1.15;
      letter-spacing: 0.2px;
    }

    .intro-subtitle {
      margin: 0;
      font-size: clamp(15px, 4vw, 18px);
      color: var(--text-soft);
      opacity: 0.95;
    }

    .buttons {
      margin-top: 4px;
      display: flex;
      gap: 12px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }

    button {
      border: none;
      font-family: inherit;
      -webkit-tap-highlight-color: transparent;
      cursor: pointer;
    }

    .primary-btn,
    .ghost-btn,
    .restart-btn {
      border-radius: 999px;
      min-width: 120px;
      padding: 13px 18px;
      font-size: 18px;
      font-weight: 700;
      transition: filter 160ms ease, background-color 160ms ease;
    }

    .primary-btn {
      color: #fff;
      background: var(--accent);
      box-shadow: 0 8px 18px rgba(231, 58, 92, 0.35);
    }

    .primary-btn:hover {
      background: var(--accent-hover);
      filter: brightness(1.03);
    }

    .ghost-btn {
      color: #fff;
      background: var(--btn-dark);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.25);
    }

    .no-btn {
      position: relative;
      --no-x: 0px;
      --no-y: 0px;
      transform: translate(var(--no-x), var(--no-y));
      transition: transform 320ms cubic-bezier(0.16, 1, 0.3, 1);
      will-change: transform;
    }

    .progress-line {
      margin: 0;
      font-size: 13px;
      letter-spacing: 0.4px;
      color: rgba(84, 32, 40, 0.7);
      text-transform: uppercase;
      font-weight: 700;
    }

    .movie-emoji {
      margin: 0;
      font-size: clamp(34px, 9vw, 50px);
      line-height: 1.1;
      text-align: center;
      letter-spacing: 3px;
    }

    .movie-emoji--winner {
      font-size: clamp(46px, 12vw, 66px);
    }

    .movie-image {
      width: 100%;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.7);
      object-fit: cover;
      aspect-ratio: 16 / 9;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.16);
    }

    .quiz-quote,
    .result-quote {
      margin: 0;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.65);
      background: rgba(255, 255, 255, 0.42);
      line-height: 1.34;
      font-size: 15px;
      text-align: left;
    }

    .timecode {
      margin: -2px 0 0;
      font-size: 13px;
      color: rgba(84, 32, 40, 0.7);
    }

    .quiz-question {
      margin: 2px 0 0;
      font-size: clamp(20px, 5.2vw, 27px);
      line-height: 1.22;
    }

    .answer-list {
      display: grid;
      gap: 10px;
    }

    .answer-btn {
      width: 100%;
      padding: 13px 14px;
      border-radius: 16px;
      border: 1px solid var(--soft-border);
      background: rgba(255, 255, 255, 0.78);
      color: var(--text-main);
      text-align: left;
      font-size: 16px;
      line-height: 1.28;
      font-weight: 600;
      transition: transform 160ms ease, background-color 160ms ease, border-color 160ms ease;
    }

    .answer-btn:hover {
      background: rgba(255, 255, 255, 0.98);
      border-color: rgba(84, 32, 40, 0.22);
      transform: translateY(-1px);
    }

    .answer-btn:active {
      transform: scale(0.99);
    }

    .result-label {
      margin: 0;
      font-size: 14px;
      color: rgba(84, 32, 40, 0.74);
      letter-spacing: 0.25px;
    }

    .result-title {
      margin: 0;
      font-size: clamp(30px, 8vw, 40px);
      line-height: 1.1;
    }

    .tie-note {
      margin: 2px 0 0;
      font-size: 13px;
      color: rgba(84, 32, 40, 0.78);
    }

    .result-link {
      justify-self: center;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: fit-content;
      min-width: 168px;
      padding: 12px 18px;
      border-radius: 999px;
      text-decoration: none;
      color: #fff;
      font-size: 17px;
      font-weight: 700;
      background: #2f3946;
      box-shadow: 0 8px 18px rgba(47, 57, 70, 0.34);
      transition: transform 160ms ease, filter 160ms ease;
    }

    .result-link:hover {
      transform: translateY(-1px);
      filter: brightness(1.06);
    }

    .result-link:active {
      transform: scale(0.98);
    }

    .result-note {
      margin: 0;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.74);
      background: rgba(255, 255, 255, 0.54);
      font-size: 14px;
      line-height: 1.35;
      color: rgba(84, 32, 40, 0.92);
    }

    .moment-screen {
      min-height: 320px;
      align-content: center;
      justify-items: center;
      text-align: center;
    }

    .moment-emoji {
      margin: 0;
      font-size: clamp(52px, 14vw, 72px);
      line-height: 1;
    }

    .moment-title {
      margin: 0;
      font-size: clamp(20px, 5vw, 28px);
      line-height: 1.15;
    }

    .moment-answer {
      margin: 0;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.54);
      border: 1px solid rgba(255, 255, 255, 0.74);
      font-size: 14px;
      line-height: 1.35;
      color: rgba(84, 32, 40, 0.92);
    }

    .result-block {
      text-align: left;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.74);
    }

    .result-block-title {
      margin: 0;
      font-size: 15px;
      font-weight: 800;
      color: rgba(84, 32, 40, 0.94);
    }

    .compat-score {
      margin: 8px 0 0;
      font-size: 16px;
      font-weight: 800;
      color: rgba(84, 32, 40, 0.94);
    }

    .compat-text {
      margin: 6px 0 0;
      font-size: 14px;
      line-height: 1.35;
      color: rgba(84, 32, 40, 0.9);
    }

    .plan-list {
      margin: 8px 0 0;
      padding-left: 18px;
      display: grid;
      gap: 6px;
      font-size: 14px;
      line-height: 1.35;
      color: rgba(84, 32, 40, 0.9);
    }

    .result-links {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 2px;
    }

    .text-link-btn {
      padding: 0;
      background: transparent;
      color: rgba(84, 32, 40, 0.88);
      font-size: 15px;
      font-weight: 600;
      text-decoration: underline;
      text-underline-offset: 3px;
      text-decoration-thickness: 1.5px;
      border: none;
    }

    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    @keyframes popIn {
      0% {
        transform: translateY(12px) scale(0.85);
        opacity: 0;
      }
      100% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
        transform: translateY(6px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes floatUp {
      0% {
        transform: translate3d(0, 0, 0) rotate(0deg);
        opacity: 0;
      }
      12% {
        opacity: 1;
      }
      100% {
        transform: translate3d(var(--drift, 0px), -115vh, 0) rotate(var(--rotate, 0deg));
        opacity: 0;
      }
    }

    @media (max-width: 380px) {
      .card {
        padding: 20px 14px;
      }

      .primary-btn,
      .ghost-btn,
      .restart-btn {
        min-width: 110px;
        font-size: 17px;
      }

      .answer-btn {
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="hearts-layer" id="heartsLayer" aria-hidden="true"></div>
  <main class="card" id="card" aria-live="polite"></main>

  <script>
    const data = {
      "meta": {
        "title": "–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞-–∫–≤–∏–∑",
        "scoring": "sum_weights_pick_max",
        "tieBreaker": "random_among_max"
      },
      "cards": [
        {
          "id": "q1",
          "image": "IMAGE_URL_AMELIE",
          "quote": "–ï—Å–ª–∏ –±—ã –Ω–µ —Ç—ã, –º–æ–∏ —á—É–≤—Å—Ç–≤–∞ –±—ã–ª–∏ –±—ã –ª–∏—à—å –±–ª–µ–¥–Ω—ã–º –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ–º —á—É–∂–æ–π –ª—é–±–≤–∏.",
          "movie": "–ê–º–µ–ª–∏",
          "timecode": "00:53:10, 01:50:18 (OKKO)",
          "question": "–ï—Å–ª–∏ –±—ã —É –Ω–∞—Å –±—ã–ª –Ω–∞—à –º–∞–ª–µ–Ω—å–∫–∏–π —Ä–∏—Ç—É–∞–ª –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –∫–∞–∫–æ–π?",
          "answers": [
            {
              "text": "–£–ª—ã–±–∞—Ç—å—Å—è –¥—Ä—É–≥ –¥—Ä—É–≥—É —É—Ç—Ä–æ–º",
              "weights": { "–ê–º–µ–ª–∏": 3, "–ü–æ–ª–Ω–æ—á—å –≤ –ü–∞—Ä–∏–∂–µ": 1 }
            },
            {
              "text": "–ü—Ä–æ—Å—Ç–æ –æ–±–Ω—è—Ç—å—Å—è",
              "weights": { "–î–æ –≤—Å—Ç—Ä–µ—á–∏ —Å —Ç–æ–±–æ–π": 2, "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": 1, "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å": 1 }
            },
            {
              "text": "–ï—Å–ª–∏ –∫—É–¥–∞-—Ç–æ —É—Ö–æ–¥–∏–º - –æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å–∫—É",
              "weights": { "500 –¥–Ω–µ–π –ª–µ—Ç–∞": 2, "–ê–º–µ–ª–∏": 1 }
            }
          ]
        },
        {
          "id": "q2",
          "image": "IMAGE_URL_MR_NOBODY",
          "quote": "–Ø —Ç–≤—ë—Ä–¥–æ –≤–µ—Ä—é –≤ –æ–¥–Ω–æ. –ß—Ç–æ –≤—Å–µ–≥–¥–∞ –Ω–∞–¥–æ –ø—Ä–∏–∑–Ω–∞–≤–∞—Ç—å—Å—è –≤ –ª—é–±–≤–∏ —Ç–µ–º, –∫–æ–≥–æ –º—ã –ª—é–±–∏–º.",
          "movie": "–ì–æ—Å–ø–æ–¥–∏–Ω –ù–∏–∫—Ç–æ",
          "timecode": "01:08:01 (Rutube)",
          "question": "–¢—ã —á–∞—â–µ –≥–æ–≤–æ—Ä–∏—à—å –º–Ω–µ ¬´–ª—é–±–ª—é¬ª‚Ä¶",
          "answers": [
            {
              "text": "–ö–æ–≥–¥–∞ —Ç–µ–±—è –ø–µ—Ä–µ–ø–æ–ª–Ω—è—é—Ç —á—É–≤—Å—Ç–≤–∞",
              "weights": { "–ì–æ—Å–ø–æ–¥–∏–Ω –ù–∏–∫—Ç–æ": 3, "–í–∞–Ω–∏–ª—å–Ω–æ–µ –Ω–µ–±–æ": 1 }
            },
            {
              "text": "–ö–æ–≥–¥–∞ –≤—Å–µ —Ö–æ—Ä–æ—à–æ –∏ —Ç—ã —Å–ø–æ–∫–æ–π–Ω–∞",
              "weights": { "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": 1, "–î–æ –≤—Å—Ç—Ä–µ—á–∏ —Å —Ç–æ–±–æ–π": 1, "–ì–æ—Å–ø–æ–¥–∏–Ω –ù–∏–∫—Ç–æ": 1, "–ü–æ–ª–Ω–æ—á—å –≤ –ü–∞—Ä–∏–∂–µ": 1 }
            },
            {
              "text": "–Ø –±–æ–ª—å—à–µ –ø–æ–∫–∞–∑—ã–≤–∞—é, —á–µ–º –≥–æ–≤–æ—Ä—é (–Ω–æ –∏–Ω–æ–≥–¥–∞ —Ç–æ–∂–µ –≥–æ–≤–æ—Ä—é!)",
              "weights": { "500 –¥–Ω–µ–π –ª–µ—Ç–∞": 1, "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å": 1, "–í–µ–∫ –ê–¥–∞–ª–∏–Ω": 2 }
            }
          ]
        },
        {
          "id": "q3",
          "image": "IMAGE_URL_AGE_OF_ADALINE",
          "quote": "–õ—é–±–æ–≤—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ –±–µ–∑ –±—É–¥—É—â–µ–≥–æ‚Ä¶ –ë–µ–∑ —ç—Ç–æ–≥–æ –ª—é–±–æ–≤—å –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞.",
          "movie": "–í–µ–∫ –ê–¥–∞–ª–∏–Ω",
          "timecode": "00:53:40 (Rutube 01:47:40)",
          "question": "–ü—Ä–µ–¥—Å—Ç–∞–≤—å –Ω–∞—Å —á–µ—Ä–µ–∑ –ø–∞—Ä—É –¥–µ—Å—è—Ç–∫–æ–≤ –ª–µ—Ç. –ß—Ç–æ —Ç–µ–±–µ —Ö–æ—á–µ—Ç—Å—è —Å–∏–ª—å–Ω–µ–µ –≤—Å–µ–≥–æ?",
          "answers": [
            {
              "text": "–ß—Ç–æ–±—ã —É –Ω–∞—Å –±—ã–ª —Å–≤–æ–π –¥–æ–º, –ø—ë—Å–µ–ª—å, —Ç–∞—á–∫–∞",
              "weights": { "–í–µ–∫ –ê–¥–∞–ª–∏–Ω": 3, "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏": 2 }
            },
            {
              "text": "–ß—Ç–æ–±—ã –º–µ–∂–¥—É –Ω–∞–º–∏ –¥–æ —Å–∏—Ö –ø–æ—Ä –∂–∏–ª–∞ —Ä–æ–º–∞–Ω—Ç–∏–∫–∞",
              "weights": { "–ê–º–µ–ª–∏": 2, "–ü–æ–ª–Ω–æ—á—å –≤ –ü–∞—Ä–∏–∂–µ": 1, "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": 1 }
            },
            {
              "text": "–ß—Ç–æ–±—ã –º—ã —Ä–æ—Å–ª–∏, –º–µ–Ω—è–ª–∏—Å—å, –Ω–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –±—ã–ª–∏ –ø—Ä–µ–¥–∞–Ω—ã –¥—Ä—É–≥ –¥—Ä—É–≥—É",
              "weights": { "–í–µ–∫ –ê–¥–∞–ª–∏–Ω": 2, "–ì–æ—Å–ø–æ–¥–∏–Ω –ù–∏–∫—Ç–æ": 1, "500 –¥–Ω–µ–π –ª–µ—Ç–∞": 1 }
            }
          ]
        },
        {
          "id": "q4",
          "image": "IMAGE_URL_PS_ILOVEYOU",
          "quote": "–ù–∞–º –Ω–µ–ª—å–∑—è –¥—Ä—É–≥ –±–µ–∑ –¥—Ä—É–≥–∞. –Ø –≤ —ç—Ç–æ–º —É–≤–µ—Ä–µ–Ω. –ü–æ—Ç–æ–º—É —á—Ç–æ –¥–æ —Å–∏—Ö –ø–æ—Ä –ø—Ä–æ—Å—ã–ø–∞—é—Å—å –∫–∞–∂–¥–æ–µ —É—Ç—Ä–æ ‚Äî –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º —Ö–æ—á—É —É–≤–∏–¥–µ—Ç—å —Ç–≤–æ—ë –ª–∏—Ü–æ. P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è",
          "movie": "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è",
          "timecode": "00:09:00 (Rutube 06:33)",
          "question": "–ü–µ—Ä–≤—ã–µ –º–∏–Ω—É—Ç—ã —É—Ç—Ä–∞ –º–µ—á—Ç—ã ‚Äî —ç—Ç–æ‚Ä¶",
          "answers": [
            {
              "text": "–ü—Ä–æ—Å–Ω—É—Ç—å—Å—è –≤–º–µ—Å—Ç–µ –∏ –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –æ–±–Ω—è—Ç—å—Å—è",
              "weights": { "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": 2, "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å": 1, "–î–æ –≤—Å—Ç—Ä–µ—á–∏ —Å —Ç–æ–±–æ–π": 1 }
            },
            {
              "text": "–ß—Ç–æ–±—ã –º—É–∂ —Å—Ö–æ–¥–∏–ª –∑–∞ –∫–æ—Ñ–µ –∏ –ø—è—Ç–Ω–∞–¥—Ü–∞—Ç—å –º–∏–Ω—É—Ç—å –ø–æ–≤–∞–ª—è—Ç—å—Å—è",
              "weights": { "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å": 1, "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": 1, "–í–µ–∫ –ê–¥–∞–ª–∏–Ω": 2 }
            },
            {
              "text": "–ü–æ—Å–º–µ—è—Ç—å—Å—è –≤–º–µ—Å—Ç–µ —Å–æ —Å–º–µ—à–Ω—ã—Ö —Ä–æ–ª–∏–∫–æ–≤",
              "weights": { "–ê–º–µ–ª–∏": 1, "500 –¥–Ω–µ–π –ª–µ—Ç–∞": 1, "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏": 1 }
            }
          ]
        },
        {
          "id": "q5",
          "image": "IMAGE_URL_ME_BEFORE_YOU",
          "quote": "–¢—ã ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π —è –≤—Å—ë –µ—â—ë –≤—Å—Ç–∞—é –ø–æ —É—Ç—Ä–∞–º.",
          "movie": "–î–æ –≤—Å—Ç—Ä–µ—á–∏ —Å —Ç–æ–±–æ–π",
          "timecode": "01:14:21 (Rutube 01:50:15)",
          "question": "–ö–æ–≥–¥–∞ —Ç—ã —É—Å—Ç–∞—ë—à—å –∏–ª–∏ –≤—Å—ë –Ω–∞–≤–∞–ª–∏–≤–∞–µ—Ç—Å—è ‚Äî —á—Ç–æ —è –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã —Ç–µ–±–µ —Å—Ç–∞–ª–æ –ª–µ–≥—á–µ?",
          "answers": [
            {
              "text": "–ü—Ä–æ—Å—Ç–æ –±—ã—Ç—å —Ä—è–¥–æ–º –∏ –º–æ–ª—á–∞ –æ–±–Ω—è—Ç—å",
              "weights": { "–î–æ –≤—Å—Ç—Ä–µ—á–∏ —Å —Ç–æ–±–æ–π": 3, "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏": 1 }
            },
            {
              "text": "–†–∞—Å—Å–º–µ—à–∏—Ç—å —Ç–µ–±—è ‚Äî —Ö–æ—Ç—å —á–µ–º, —Ö–æ—Ç—å –≥–ª—É–ø–æ—Å—Ç—å—é",
              "weights": { "–ê–º–µ–ª–∏": 2, "–ü–æ–ª–Ω–æ—á—å –≤ –ü–∞—Ä–∏–∂–µ": 1, "500 –¥–Ω–µ–π –ª–µ—Ç–∞": 1 }
            },
            {
              "text": "–°–∫–∞–∑–∞—Ç—å: ¬´—è —Å —Ç–æ–±–æ–π¬ª ‚Äî –∏ –≤–º–µ—Å—Ç–µ —Ä–∞–∑–≥—Ä–µ—Å—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É",
              "weights": { "–î–æ –≤—Å—Ç—Ä–µ—á–∏ —Å —Ç–æ–±–æ–π": 2, "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": 1, "–ì–æ—Å–ø–æ–¥–∏–Ω –ù–∏–∫—Ç–æ": 2 }
            }
          ]
        },
        {
          "id": "q6",
          "image": "IMAGE_URL_VANILLA_SKY",
          "quote": "–≠—Ç–∞ —É–ª—ã–±–∫–∞ ‚Äî –º–æ—è –ø–æ–≥–∏–±–µ–ª—å.",
          "movie": "–í–∞–Ω–∏–ª—å–Ω–æ–µ –Ω–µ–±–æ",
          "timecode": "00:33:43",
          "question": "–¢—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞, —á—Ç–æ –≤—Å–µ –≤–æ–∫—Ä—É–≥ –∏—Å—á–µ–∑–ª–æ –∏ –æ—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –º—ã —Å —Ç–æ–±–æ–π?",
          "answers": [
            {
              "text": "–î–∞. –í —Ç–∞–∫–∏–µ —Å–µ–∫—É–Ω–¥—ã –º–∏—Ä —Ä–µ–∞–ª—å–Ω–æ –∏—Å—á–µ–∑–∞–µ—Ç",
              "weights": { "–í–∞–Ω–∏–ª—å–Ω–æ–µ –Ω–µ–±–æ": 3 }
            },
            {
              "text": "–ò–Ω–æ–≥–¥–∞, —ç—Ç–æ –±—ã–≤–∞–µ—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ",
              "weights": { "–í–∞–Ω–∏–ª—å–Ω–æ–µ –Ω–µ–±–æ": 3, "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": 1 }
            },
            {
              "text": "–†–µ–¥–∫–æ, –Ω–æ –µ—Å–ª–∏ —Å–ª—É—á–∞–µ—Ç—Å—è, —Ç–æ —è —ç—Ç–æ –æ—á–µ–Ω—å —Ü–µ–Ω—é",
              "weights": { "–í–µ–∫ –ê–¥–∞–ª–∏–Ω": 2, "–í–∞–Ω–∏–ª—å–Ω–æ–µ –Ω–µ–±–æ": 1 }
            }
          ]
        },
        {
          "id": "q7",
          "image": "IMAGE_URL_IF_I_STAY",
          "quote": "–ú–æ–π –¥–æ–º ‚Äî —ç—Ç–æ —Ç—ã. –ù–µ–≤–∞–∂–Ω–æ –≥–¥–µ –º—ã –±—É–¥–µ–º, –≥–ª–∞–≤–Ω–æ–µ, —á—Ç–æ –º—ã –≤–º–µ—Å—Ç–µ.",
          "movie": "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å",
          "timecode": "01:37:52 (Rutube 01:46:40)",
          "question": "–ï—Å–ª–∏ –±—ã –º—ã –º–æ–≥–ª–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫—É–¥–∞ —É–≥–æ–¥–Ω–æ –≤–¥–≤–æ—ë–º ‚Äî –∫—É–¥–∞ –±—ã —Ç—ã –≤—ã–±—Ä–∞–ª–∞?",
          "answers": [
            {
              "text": "–ù–∞ –ú–∞–ª—å–¥–∏–≤—ã, –º–æ—Ä–µ, —Ç–∏—à–∏–Ω–∞, –∏ –Ω–∏–∫—É–¥–∞ –Ω–µ —Å–ø–µ—à–∏—Ç—å",
              "weights": { "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å": 3, "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": 1 }
            },
            {
              "text": "–í –Ω–∞—à –ü–∞—Ä–∏–∂, –≥—É–ª—è—Ç—å –∏ —Ç–µ—Ä—è—Ç—å—Å—è –Ω–∞ —É–ª–∏—Ü–∞—Ö",
              "weights": { "–ü–æ–ª–Ω–æ—á—å –≤ –ü–∞—Ä–∏–∂–µ": 2, "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏": 2, "–ê–º–µ–ª–∏": 1 }
            },
            {
              "text": "–í –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ, —Å—Ç—Ä–∞–Ω—É, –∑–∞ –Ω–∞—à–∏–º –Ω–æ–≤—ã–º –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ–º",
              "weights": { "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å": 1, "–ì–æ—Å–ø–æ–¥–∏–Ω –ù–∏–∫—Ç–æ": 2, "–í–µ–∫ –ê–¥–∞–ª–∏–Ω": 1 }
            }
          ]
        },
        {
          "id": "q8",
          "image": "IMAGE_URL_500_DAYS",
          "quote": "–õ—é–±–ª—é –µ—ë —É–ª—ã–±–∫—É. –õ—é–±–ª—é –≤–æ–ª–æ—Å—ã. –õ—é–±–ª—é –∫–æ–ª–µ–Ω–∏‚Ä¶ –õ—é–±–ª—é –µ—ë —Å–º–µ—Ö. –õ—é–±–ª—é, –∫–∞–∫ –æ–Ω–∞ –≤—ã–≥–ª—è–¥–∏—Ç, –∫–æ–≥–¥–∞ —Å–ø–∏—Ç.",
          "movie": "500 –¥–Ω–µ–π –ª–µ—Ç–∞",
          "timecode": "00:13:43 (Rutube 01:35:04)",
          "question": "–í –∫–∞–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã —Ç—ã –ª–æ–≤–∏—à—å —Å–µ–±—è –Ω–∞ –º—ã—Å–ª–∏: ¬´—è –∑–∞–ø–æ–º–Ω—é —ç—Ç–æ¬ª?",
          "answers": [
            {
              "text": "–ö–æ–≥–¥–∞ –º—ã —Å–º–µ—ë–º—Å—è –Ω–∞–¥ —á–µ–º-—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –≥–ª—É–ø—ã–º",
              "weights": { "500 –¥–Ω–µ–π –ª–µ—Ç–∞": 3, "–í–∞–Ω–∏–ª—å–Ω–æ–µ –Ω–µ–±–æ": 1 }
            },
            {
              "text": "–ö–æ–≥–¥–∞ –º—ã –≤ —Å–æ–≤—Å–µ–º –Ω–æ–≤–æ–º –º–µ—Å—Ç–µ",
              "weights": { "500 –¥–Ω–µ–π –ª–µ—Ç–∞": 2, "–ê–º–µ–ª–∏": 1, "–ü–æ–ª–Ω–æ—á—å –≤ –ü–∞—Ä–∏–∂–µ": 1 }
            },
            {
              "text": "–ö–æ–≥–¥–∞ —Ä—è–¥–æ–º —Å–ø–æ–∫–æ–π–Ω–æ, —Ç–∏—Ö–æ –∏ —É—é—Ç–Ω–æ",
              "weights": { "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å": 2, "–î–æ –≤—Å—Ç—Ä–µ—á–∏ —Å —Ç–æ–±–æ–π": 1, "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": 1 }
            }
          ]
        },
        {
          "id": "q9",
          "image": "IMAGE_URL_GATSBY",
          "quote": "–≠—Ç–æ –≤—Å—ë –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç–µ–±–µ. –í –∫–∞–∂–¥–æ–π –∏–¥–µ–µ ‚Äî —Ç—ã. –í –∫–∞–∂–¥–æ–π –≤–µ—â–∏. –ò –µ—Å–ª–∏ —Ç–µ–±–µ —á—Ç–æ-—Ç–æ –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, —è –≥–æ—Ç–æ–≤ –≤—Å—ë –ø–æ–º–µ–Ω—è—Ç—å.",
          "movie": "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏",
          "timecode": "01:13:30 (Rutube 02:22:05)",
          "question": "–ï—Å–ª–∏ —Ä–∞–¥–∏ –ª—é–±–≤–∏ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å ‚Äî —á—Ç–æ –¥–ª—è —Ç–µ–±—è –¥–∞—ë—Ç—Å—è –ª–µ–≥—á–µ –≤—Å–µ–≥–æ?",
          "answers": [
            {
              "text": "–ü–æ–º–µ–Ω—è—Ç—å –ø–ª–∞–Ω—ã, –ø—Ä–∏–≤—ã—á–∫–∏, –≤—Å—ë",
              "weights": { "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏": 3 }
            },
            {
              "text": "–ü–æ–¥—Å—Ç—Ä–æ–∏—Ç—å—Å—è –≤ –º–µ–ª–æ—á–∞—Ö",
              "weights": { "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏": 2, "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å": 1, "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": 1 }
            },
            {
              "text": "–Ø —Ö–æ—á—É –±—ã—Ç—å —á–µ—Å—Ç–Ω–æ–π –∏ –Ω–µ –∏–≥—Ä–∞—Ç—å —Ä–æ–ª—å, –¥–∞–∂–µ –µ—Å–ª–∏ —ç—Ç–æ —Å–ª–æ–∂–Ω–æ",
              "weights": { "–ì–æ—Å–ø–æ–¥–∏–Ω –ù–∏–∫—Ç–æ": 2, "500 –¥–Ω–µ–π –ª–µ—Ç–∞": 1, "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏": 1 }
            }
          ]
        },
        {
          "id": "q10",
          "image": "IMAGE_URL_MIDNIGHT_IN_PARIS",
          "quote": "–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –≥—É–ª—è—Ç—å —Å –≤–∞–º–∏. –í—ã –ø–æ—Ç—Ä—è—Å–∞—é—â–µ –≤—ã–≥–ª—è–¥–∏—Ç–µ.",
          "movie": "–ü–æ–ª–Ω–æ—á—å –≤ –ü–∞—Ä–∏–∂–µ",
          "timecode": "00:52:15 (Rutube 01:33:56)",
          "question": "–ò–¥–µ–∞–ª—å–Ω–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ –≤–µ—á–µ—Ä–æ–º, –∫–æ–≥–¥–∞ –º—ã –≤–µ—Ä–Ω–µ–º—Å—è ‚Äî —ç—Ç–æ‚Ä¶",
          "answers": [
            {
              "text": "–î–æ–ª–≥–∞—è –ø—Ä–æ–≥—É–ª–∫–∞, —Ä–∞–∑–≥–æ–≤–æ—Ä—ã, —Ä–µ—Å—Ç–æ—Ä–∞–Ω/–±–∞—Ä",
              "weights": { "–ü–æ–ª–Ω–æ—á—å –≤ –ü–∞—Ä–∏–∂–µ": 3, "–ê–º–µ–ª–∏": 1 }
            },
            {
              "text": "–ö–∏–Ω–æ/—Ä–æ–ª–ª–∫–∏/–∫—Ä–æ–≤–∞—Ç—å ‚Äî —Ç–æ–ª—å–∫–æ –º—ã –≤–¥–≤–æ–µ–º",
              "weights": { "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": 1, "–î–æ –≤—Å—Ç—Ä–µ—á–∏ —Å —Ç–æ–±–æ–π": 2, "–í–∞–Ω–∏–ª—å–Ω–æ–µ –Ω–µ–±–æ": 1, "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å": 1 }
            },
            {
              "text": "–ß—Ç–æ-—Ç–æ —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ–µ: ¬´–ø–æ–µ—Ö–∞–ª–∏¬ª –∏ –ø—Ä–∏–¥—É–º–∞–ª–∏ –Ω–∞ —Ö–æ–¥—É",
              "weights": { "–ü–æ–ª–Ω–æ—á—å –≤ –ü–∞—Ä–∏–∂–µ": 2, "–ì–æ—Å–ø–æ–¥–∏–Ω –ù–∏–∫—Ç–æ": 1, "–í–∞–Ω–∏–ª—å–Ω–æ–µ –Ω–µ–±–æ": 2 }
            }
          ]
        }
      ],
      "movies": [
        { "title": "–ê–º–µ–ª–∏", "image": "IMAGE_URL_AMELIE" },
        { "title": "–ì–æ—Å–ø–æ–¥–∏–Ω –ù–∏–∫—Ç–æ", "image": "IMAGE_URL_MR_NOBODY" },
        { "title": "–í–µ–∫ –ê–¥–∞–ª–∏–Ω", "image": "IMAGE_URL_AGE_OF_ADALINE" },
        { "title": "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è", "image": "IMAGE_URL_PS_ILOVEYOU" },
        { "title": "–î–æ –≤—Å—Ç—Ä–µ—á–∏ —Å —Ç–æ–±–æ–π", "image": "IMAGE_URL_ME_BEFORE_YOU" },
        { "title": "–í–∞–Ω–∏–ª—å–Ω–æ–µ –Ω–µ–±–æ", "image": "IMAGE_URL_VANILLA_SKY" },
        { "title": "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å", "image": "IMAGE_URL_IF_I_STAY" },
        { "title": "500 –¥–Ω–µ–π –ª–µ—Ç–∞", "image": "IMAGE_URL_500_DAYS" },
        { "title": "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏", "image": "IMAGE_URL_GATSBY" },
        { "title": "–ü–æ–ª–Ω–æ—á—å –≤ –ü–∞—Ä–∏–∂–µ", "image": "IMAGE_URL_MIDNIGHT_IN_PARIS" }
      ]
    };

    const movieEmojiMap = {
      "–ê–º–µ–ª–∏": "üéÄ‚òïÔ∏èüóº",
      "–ì–æ—Å–ø–æ–¥–∏–Ω –ù–∏–∫—Ç–æ": "üß©üï∞Ô∏èüí≠",
      "–í–µ–∫ –ê–¥–∞–ª–∏–Ω": "üåπ‚åõÔ∏è‚ú®",
      "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": "üíå‚òòÔ∏è‚ù§Ô∏è",
      "–î–æ –≤—Å—Ç—Ä–µ—á–∏ —Å —Ç–æ–±–æ–π": "üß£ü´∂üå¶Ô∏è",
      "–í–∞–Ω–∏–ª—å–Ω–æ–µ –Ω–µ–±–æ": "‚òÅÔ∏èüí´üëÅÔ∏è",
      "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å": "üéªüè°üíû",
      "500 –¥–Ω–µ–π –ª–µ—Ç–∞": "üì∏üå¶Ô∏èüíõ",
      "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏": "ü•Ç‚ú®üé©",
      "–ü–æ–ª–Ω–æ—á—å –≤ –ü–∞—Ä–∏–∂–µ": "üåôüóºüö∂"
    };

    const movieLinks = {
      "–ê–º–µ–ª–∏": "https://okko.tv/movie/le-fabuleux-destin-damelie-poulain",
      "–ì–æ—Å–ø–æ–¥–∏–Ω –ù–∏–∫—Ç–æ": "https://rutube.ru/video/0993c93d7c7844a3c82faeac3a479da1/",
      "–í–µ–∫ –ê–¥–∞–ª–∏–Ω": "https://rutube.ru/video/abd22f590a351ffae1aa57990e420351/",
      "P.S. –Ø –ª—é–±–ª—é —Ç–µ–±—è": "https://rutube.ru/video/495fbc758bf2c9ed16b52cd5830feddb/",
      "–î–æ –≤—Å—Ç—Ä–µ—á–∏ —Å —Ç–æ–±–æ–π": "https://rutube.ru/video/f9e2cabb6d5bdc58665d6b38383f78a6/",
      "–í–∞–Ω–∏–ª—å–Ω–æ–µ –Ω–µ–±–æ": "https://rutube.ru/video/16fd611834ad9bc067c431b8eeded3dc/",
      "–ï—Å–ª–∏ —è –æ—Å—Ç–∞–Ω—É—Å—å": "https://rutube.ru/video/d50a22156a9300d5971b487605a7bc21/",
      "500 –¥–Ω–µ–π –ª–µ—Ç–∞": "https://rutube.ru/video/82609c1b9734f65ccf94d46c735d62e1/",
      "–í–µ–ª–∏–∫–∏–π –ì—ç—Ç—Å–±–∏": "https://rutube.ru/video/6b4e8828177e8da205dea25abaf5e880/",
      "–ü–æ–ª–Ω–æ—á—å –≤ –ü–∞—Ä–∏–∂–µ": "https://rutube.ru/video/7f14f444a4a2b3b6e8ddab41e0d82a4f/"
    };

    const myAnswers = {
      "q1": 1,
      "q2": 1,
      "q3": 1,
      "q4": 2,
      "q5": 0,
      "q6": 0,
      "q7": 1,
      "q8": 1,
      "q9": 0,
      "q10": 0
    };

    const momentPhrases = [
      "–≠—Ç–æ –ø—Ä—è–º–æ –≤ —Å–µ—Ä–¥—Ü–µ! üíò",
      "–í–æ—Ç –µ—Ç–æ –ø–æ-–Ω–∞—à–µ–Ω—Å–∫–∏! ‚ú®",
      "–ó–∞–ø–æ–º–Ω–∏–ª. –≠—Ç–æ –∑–∞–±–∏—Ä–∞–µ–º –≤ –Ω–∞—à –¥–µ–Ω—å ‚ù§Ô∏è",
      "–õ—É—á—à–∏–π –≤—ã–±–æ—Ä, –ª—é–±–∏–º–∞—è ü´∂",
      "–ï–µ–µ–µ–µ –µ—Ç–æ –Ω–∞—à –≤–∞–π–± üåô"
    ];

    const heartsLayer = document.getElementById("heartsLayer");
    const card = document.getElementById("card");

    const heartEmojis = ["‚ù§Ô∏è", "üíñ", "üíò", "üíù", "üíó", "üíï", "üíû"];
    let noX = 0;
    let noY = 0;
    let resetTimer;
    let currentCardIndex = 0;
    let userAnswers = {};
    let isTransitioning = false;
    let lastResultPayload = null;

    function random(min, max) {
      return Math.random() * (max - min) + min;
    }

    function clamp(value, min, max) {
      return Math.min(max, Math.max(min, value));
    }

    function escapeHtml(value) {
      return String(value).replace(/[&<>"']/g, (char) => {
        const map = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          "\"": "&quot;",
          "'": "&#39;"
        };
        return map[char];
      });
    }

    function spawnHeart() {
      const heart = document.createElement("span");
      heart.className = "heart";
      heart.textContent = heartEmojis[Math.floor(Math.random() * heartEmojis.length)];

      heart.style.left = `${random(0, 100)}vw`;
      heart.style.animationDuration = `${random(4.5, 8.5)}s`;
      heart.style.animationDelay = `${random(0, 0.25)}s`;
      heart.style.setProperty("--drift", `${random(-90, 90)}px`);
      heart.style.setProperty("--rotate", `${random(-22, 22)}deg`);

      heartsLayer.appendChild(heart);
      heart.addEventListener("animationend", () => heart.remove(), { once: true });
    }

    function getNoButton() {
      return card.querySelector("#noBtn");
    }

    function setNoOffset(x, y) {
      const noBtn = getNoButton();
      if (!noBtn) {
        noX = 0;
        noY = 0;
        return;
      }

      noX = clamp(x, -68, 68);
      noY = clamp(y, -48, 48);
      noBtn.style.setProperty("--no-x", `${noX}px`);
      noBtn.style.setProperty("--no-y", `${noY}px`);
    }

    function scheduleNoReset() {
      clearTimeout(resetTimer);
      resetTimer = setTimeout(() => setNoOffset(0, 0), 260);
    }

    function moveNoAway(clientX, clientY) {
      const noBtn = getNoButton();
      if (!noBtn) return;

      const rect = noBtn.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;

      let dx = centerX - clientX;
      let dy = centerY - clientY;
      let dist = Math.hypot(dx, dy);
      const radius = 150;

      if (dist > radius) {
        scheduleNoReset();
        return;
      }

      if (dist < 1) {
        const angle = random(0, Math.PI * 2);
        dx = Math.cos(angle);
        dy = Math.sin(angle);
        dist = 1;
      }

      const power = (radius - dist) / radius;
      const step = 11 + power * 25;
      setNoOffset(noX + (dx / dist) * step, noY + (dy / dist) * step);
      scheduleNoReset();
    }

    function isRealImageUrl(url) {
      return typeof url === "string" && url.trim() !== "" && !url.startsWith("IMAGE_URL_");
    }

    function getMovieEmoji(movieTitle) {
      return movieEmojiMap[movieTitle] || "üé¨‚ù§Ô∏è";
    }

    function renderMovieVisual(movieTitle, imageUrl, alt, winner = false) {
      if (isRealImageUrl(imageUrl)) {
        return `<img class="movie-image" src="${escapeHtml(imageUrl)}" alt="${escapeHtml(alt || movieTitle)}">`;
      }

      const classes = winner ? "movie-emoji movie-emoji--winner" : "movie-emoji";
      return `<p class="${classes}" aria-hidden="true">${escapeHtml(getMovieEmoji(movieTitle))}</p>`;
    }

    function renderIntro() {
      currentCardIndex = 0;
      userAnswers = {};
      noX = 0;
      noY = 0;
      isTransitioning = false;
      lastResultPayload = null;

      card.innerHTML = `
        <section class="card-inner screen-center">
          <p class="main-emoji">üòç</p>
          <h1 class="intro-title">–ë—É–¥–µ—à—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π?</h1>
          <p class="intro-subtitle">–°–∫–∞–∂–∏ ¬´–î–∞¬ª –∏ –ø—Ä–æ–π–¥–∏ –º–∏–Ω–∏-–∫–≤–∏–∑ –ø—Ä–æ –Ω–∞—Å –∏ –∫–∏–Ω–æ üíò</p>
          <div class="buttons">
            <button id="yesBtn" class="primary-btn" type="button">–î–∞</button>
            <button id="noBtn" class="ghost-btn no-btn" type="button">–ù–µ—Ç</button>
          </div>
        </section>
      `;
    }

    function renderQuestion(cardData, index) {
      const progress = `–í–æ–ø—Ä–æ—Å ${index + 1} –∏–∑ ${data.cards.length}`;
      const answersHtml = cardData.answers
        .map((answer, answerIndex) => (
          `<button type="button" class="answer-btn" data-answer-index="${answerIndex}">${escapeHtml(answer.text)}</button>`
        ))
        .join("");

      card.innerHTML = `
        <section class="card-inner">
          <p class="progress-line">${progress}</p>
          ${renderMovieVisual(cardData.movie, cardData.image, cardData.movie, false)}
          <blockquote class="quiz-quote">¬´${escapeHtml(cardData.quote)}¬ª</blockquote>
          <p class="timecode">–¢–∞–π–º–∫–æ–¥: ${escapeHtml(cardData.timecode)}</p>
          <h2 class="quiz-question">${escapeHtml(cardData.question)}</h2>
          <div class="answer-list">${answersHtml}</div>
        </section>
      `;

      card.scrollTop = 0;
    }

    function getMomentEmoji(answerText) {
      const text = String(answerText || "").toLowerCase();
      if (text.includes("–∫–æ—Ñ")) return "‚òïÔ∏è";
      if (text.includes("–ø–∞—Ä–∏–∂")) return "üóº";
      if (text.includes("—Å–º–µ")) return "üòÇ";
      if (text.includes("–æ–±–Ω—è—Ç")) return "ü§ó";
      if (text.includes("–∫–∏–Ω–æ")) return "üé¨";
      if (text.includes("–ø—Ä–∏–∫–ª—é—á")) return "üß≠";
      return "üíû";
    }

    function renderAnswerMoment(answerText) {
      const phrase = momentPhrases[Math.floor(Math.random() * momentPhrases.length)];
      const emoji = getMomentEmoji(answerText);

      card.innerHTML = `
        <section class="card-inner moment-screen">
          <p class="moment-emoji">${emoji}</p>
          <h2 class="moment-title">${escapeHtml(phrase)}</h2>
          <p class="moment-answer">¬´${escapeHtml(answerText)}¬ª</p>
        </section>
      `;
    }

    function getCompatibilityText(percent) {
      if (percent >= 90) return "–ú—ã —á—É–≤—Å—Ç–≤—É–µ–º –¥—Ä—É–≥ –¥—Ä—É–≥–∞ üòç";
      if (percent >= 70) return "–ê —è –≥–æ–≤–æ—Ä–∏–ª —á—Ç–æ —ç—Ç–æ –Ω–∞–∞–∞—à –≤–∞–π–± üí´";
      if (percent >= 50) return "–£ –Ω–∞—Å –≤—Å–µ–≥–¥–∞ –±—ã–ª –±–∞–ª–∞–Ω—Å, –ø–æ—ç—Ç–æ–º—É –Ω–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º ü§ç";
      return "–ü–æ—ç—Ç–æ–º—É –Ω–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —Å —Ç–æ–±–æ–π –º–∞–ª—ã—à ‚ù§Ô∏è";
    }

    function calculateCompatibility() {
      let matches = 0;
      const total = data.cards.length;

      data.cards.forEach((cardData) => {
        const wifeIndex = userAnswers[cardData.id];
        const myIndex = myAnswers[cardData.id];
        if (typeof wifeIndex === "number" && typeof myIndex === "number" && wifeIndex === myIndex) {
          matches += 1;
        }
      });

      const percent = Math.round((matches / Math.max(total, 1)) * 100);
      return {
        matches,
        total,
        percent,
        text: getCompatibilityText(percent)
      };
    }

    function buildDatePlan(resultTitle) {
      const morningOptions = [
        "–ù–µ—Å–ø–µ—à–Ω–æ–µ —É—Ç—Ä–æ: –≤–º–µ—Å—Ç–µ –ø—Ä–æ—Å–Ω—É–ª–∏—Å—å, –æ–±–Ω—è–ª–∏—Å—å –∏ –Ω–µ–º–Ω–æ–≥–æ –ø–æ–≤–∞–ª—è–ª–∏—Å—å.",
        "–ö–æ—Ñ–µ –≤ –ø–æ—Å—Ç–µ–ª—å –∏ —É—é—Ç–Ω—ã–π —Å—Ç–∞—Ä—Ç –¥–Ω—è.",
        "–°–º–µ—à–Ω—ã–µ —Ä–æ–ª–∏–∫–∏ –≤ –∫—Ä–æ–≤–∞—Ç–∏ –∏ —Ö–æ—Ö–æ—á–∏–º"
      ];

      const careOptions = [
        "–î–Ω–µ–º –æ–±–Ω–∏–º–∞—à–∫–∏ –∏ —Ç–∏—à–∏–Ω–∞, —Ç–æ–ª—å–∫–æ –º—ã –≤–¥–≤–æ–µ–º.",
        "–î–æ–±–∞–≤–ª—è–µ–º –ª–µ–≥–∫–æ—Å—Ç–∏: —à—É—Ç–∫–∏, –ø–æ–¥–∫–æ–ª—ã –∏ —Ç–≤–æ—è –ª—é–±–∏–º–∞—è —É–ª—ã–±–∫–∞.",
        "–ö–æ–º–∞–Ω–¥–Ω—ã–π —Ä–µ–∂–∏–º: –≤–º–µ—Å—Ç–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–µ–ª–∫–∏–µ –¥–µ–ª–∞ –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –≤–µ—á–µ—Ä."
      ];

      const routeOptions = [
        "–ü—Ä–æ—Å—Ç–æ –æ—Ç–¥—ã—Ö–∞–µ–º: –∫—Ä–∞—Å–∏–≤–æ–µ –º–µ—Å—Ç–æ –∏ —Å–ø–æ–∫–æ–π–Ω—ã–π —Ç–µ–º–ø.",
        "–†–æ–º–∞–Ω—Ç–∏—á–Ω–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É –≤ —Å—Ç–∏–ª–µ ¬´–Ω–∞—à –ü–∞—Ä–∏–∂¬ª.",
        "–ù–µ–º–Ω–æ–≥–æ —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç–∏: –≤—ã–±–∏—Ä–∞–µ–º –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ –Ω–∞ —Ö–æ–¥—É."
      ];

      const eveningOptions = [
        "–í–µ—á–µ—Ä–æ–º –∏–¥–µ–º –Ω–∞ –¥–æ–ª–≥—É—é –ø—Ä–æ–≥—É–ª–∫—É –∏ —É–∂–∏–Ω, –∞ –ø–æ—Ç–æ–º –±–∞—Ä—á–∏–∫!",
        "–î–æ–º–∞—à–Ω–∏–π –≤–µ—á–µ—Ä: —Ä–æ–ª–ª—ã, –æ–¥–µ—è–ª–∫–æ –∏ –ø–æ–ª–Ω—ã–π —Ä–µ–∂–∏–º ¬´—Ç–æ–ª—å–∫–æ –º—ã¬ª, –±–µ–∑ —Ç–µ–ª–µ–±–æ–º–∞.",
        "–ú–∏–Ω–∏-–ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ: –≤—ã–±–∏—Ä–∞–µ–º –ø–ª–∞–Ω –∏ –µ–¥–µ–º –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ"
      ];

      const memoryOptions = [
        "–õ–æ–≤–∏–º –º–æ–º–µ–Ω—Ç—ã –¥–ª—è –ø–∞–º—è—Ç–∏: —à—É—Ç–∏–º –∏ —Å–º–µ–µ–º—Å—è –Ω–∞–¥ –º–µ–ª–æ—á–∞–º–∏.",
        "–î–µ–ª–∞–µ–º –ø–∞—Ä—É —Ñ–æ—Ç–æ –≤ –Ω–æ–≤–æ–º –º–µ—Å—Ç–µ, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å.",
        "–ú–Ω–æ–≥–æ —Ç–µ–ø–ª–∞, —Ç–∏—à–∏–Ω—ã, –∏ –Ω–∞—Å —Å —Ç–æ–±–æ–π."
      ];

      const q4 = userAnswers["q4"];
      const q5 = userAnswers["q5"];
      const q7 = userAnswers["q7"];
      const q8 = userAnswers["q8"];
      const q10 = userAnswers["q10"];

      return [
        morningOptions[q4] || morningOptions[1],
        careOptions[q5] || careOptions[0],
        routeOptions[q7] || routeOptions[1],
        eveningOptions[q10] || eveningOptions[1],
        memoryOptions[q8] || memoryOptions[2],
        `–§–∏–Ω–∞–ª –¥–Ω—è: –≤–∫–ª—é—á–∞–µ–º ¬´${resultTitle}¬ª –∏ –∏—â–µ–º –Ω–∞—à –º–æ–º–µ–Ω—Ç –ø–æ —Ç–∞–π–º–∫–æ–¥—É üíò`
      ];
    }

    function drawRoundedRectPath(ctx, x, y, width, height, radius) {
      const r = Math.min(radius, width / 2, height / 2);
      ctx.beginPath();
      ctx.moveTo(x + r, y);
      ctx.arcTo(x + width, y, x + width, y + height, r);
      ctx.arcTo(x + width, y + height, x, y + height, r);
      ctx.arcTo(x, y + height, x, y, r);
      ctx.arcTo(x, y, x + width, y, r);
      ctx.closePath();
    }

    function drawWrappedText(ctx, text, x, y, maxWidth, lineHeight, maxLines) {
      const words = String(text).split(/\s+/).filter(Boolean);
      let line = "";
      let linesUsed = 0;
      let cursorY = y;

      for (let i = 0; i < words.length; i++) {
        const candidate = line ? `${line} ${words[i]}` : words[i];
        const width = ctx.measureText(candidate).width;

        if (width <= maxWidth) {
          line = candidate;
          continue;
        }

        ctx.fillText(line, x, cursorY);
        linesUsed += 1;
        if (maxLines && linesUsed >= maxLines) return cursorY;
        cursorY += lineHeight;
        line = words[i];
      }

      if (line) {
        ctx.fillText(line, x, cursorY);
      }

      return cursorY;
    }

    function shortenForPostcard(text, maxChars) {
      const input = String(text || "").trim();
      if (input.length <= maxChars) return input;
      return `${input.slice(0, maxChars - 1)}‚Ä¶`;
    }

    function buildPostcardCanvas(payload) {
      const { result, compatibility, datePlan } = payload;
      const canvas = document.createElement("canvas");
      canvas.width = 1080;
      canvas.height = 1080;
      const ctx = canvas.getContext("2d");
      if (!ctx) return null;

      const bg = ctx.createLinearGradient(0, 0, 1080, 1080);
      bg.addColorStop(0, "#ff9aa8");
      bg.addColorStop(0.5, "#ffd36e");
      bg.addColorStop(1, "#ffb56b");
      ctx.fillStyle = bg;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.globalAlpha = 0.18;
      for (let i = 0; i < 18; i++) {
        ctx.font = `${24 + (i % 4) * 5}px "Apple Color Emoji", "Segoe UI Emoji", sans-serif`;
        ctx.fillText("üíñ", 40 + (i * 95) % 980, 80 + (i * 131) % 920);
      }
      ctx.globalAlpha = 1;

      drawRoundedRectPath(ctx, 56, 56, 968, 968, 42);
      ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
      ctx.fill();

      let y = 132;
      ctx.fillStyle = "#6f2733";
      ctx.textAlign = "center";
      ctx.font = '700 52px "Trebuchet MS", sans-serif';
      ctx.fillText("–ù–∞—à —Å —Ç–æ–±–æ–π —Ñ–∏–ª—å–º", 540, y);

      y += 78;
      ctx.font = '58px "Apple Color Emoji", "Segoe UI Emoji", sans-serif';
      ctx.fillText(getMovieEmoji(result.resultTitle), 540, y);

      y += 76;
      ctx.font = '700 64px "Trebuchet MS", sans-serif';
      y = drawWrappedText(ctx, result.resultTitle, 540, y, 860, 66, 2);

      y += 38;
      drawRoundedRectPath(ctx, 122, y - 34, 836, 140, 24);
      ctx.fillStyle = "rgba(255, 255, 255, 0.62)";
      ctx.fill();

      ctx.fillStyle = "#6f2733";
      ctx.font = '500 33px "Trebuchet MS", sans-serif';
      y = drawWrappedText(ctx, `¬´${result.quote}¬ª`, 540, y, 760, 40, 3);

      y += 62;
      ctx.font = '700 34px "Trebuchet MS", sans-serif';
      ctx.fillText(`–°–æ–≤–ø–∞–ª–æ —Å –º–æ–∏–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏: ${compatibility.matches}/${compatibility.total}`, 540, y);

      y += 42;
      ctx.font = '500 28px "Trebuchet MS", sans-serif';
      y = drawWrappedText(ctx, compatibility.text, 540, y, 820, 36, 2);

      y += 56;
      ctx.font = '700 38px "Trebuchet MS", sans-serif';
      ctx.fillText("–ù–∞—à–µ –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ ‚ú®", 540, y);

      y += 38;
      ctx.font = '500 25px "Trebuchet MS", sans-serif';
      datePlan.slice(0, 3).forEach((line) => {
        if (y > 846) return;
        const shortLine = shortenForPostcard(line, 58);
        y = drawWrappedText(ctx, `‚Ä¢ ${shortLine}`, 540, y, 860, 34, 1);
        y += 18;
      });

      const yearLabel = new Date().getFullYear();
      const footerY = Math.min(968, Math.max(910, y + 30));

      ctx.font = '600 30px "Trebuchet MS", sans-serif';
      drawWrappedText(
        ctx,
        `14 —Ñ–µ–≤—Ä–∞–ª—è ${yearLabel} ‚Ä¢ –°–æ—Ö—Ä–∞–Ω–∏: –æ–±–µ—â–∞–Ω–∏–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —ç—Ç–æ—Ç —Ñ–∏–ª—å–º –≤–º–µ—Å—Ç–µ ‚ù§Ô∏è`,
        540,
        footerY,
        860,
        38,
        2
      );

      ctx.textAlign = "left";

      return canvas;
    }

    function savePostcard(payload) {
      const canvas = buildPostcardCanvas(payload);
      if (!canvas) return;

      const fileName = "nash-film-square.png";
      if (canvas.toBlob) {
        canvas.toBlob((blob) => {
          if (!blob) return;
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = fileName;
          link.click();
          setTimeout(() => URL.revokeObjectURL(url), 1200);
        }, "image/png");
        return;
      }

      const link = document.createElement("a");
      link.href = canvas.toDataURL("image/png");
      link.download = fileName;
      link.click();
    }

    function calculateResult() {
      const scores = {};

      data.movies.forEach((movie) => {
        scores[movie.title] = 0;
      });

      data.cards.forEach((cardData) => {
        const chosenIndex = userAnswers[cardData.id];
        if (typeof chosenIndex !== "number") return;

        const chosenAnswer = cardData.answers[chosenIndex];
        if (!chosenAnswer || !chosenAnswer.weights) return;

        Object.entries(chosenAnswer.weights).forEach(([movieTitle, weightRaw]) => {
          const weight = Number(weightRaw) || 0;
          scores[movieTitle] = (scores[movieTitle] || 0) + weight;
        });
      });

      const scoreValues = Object.values(scores);
      const maxScore = scoreValues.length ? Math.max(...scoreValues) : 0;
      const winners = Object.keys(scores).filter((movieTitle) => scores[movieTitle] === maxScore);

      let resultTitle = winners[0] || data.movies[0].title;
      if (winners.length > 1 && data.meta.tieBreaker === "random_among_max") {
        const randomWinnerIndex = Math.floor(Math.random() * winners.length);
        resultTitle = winners[randomWinnerIndex];
      }

      const resultMovie = data.movies.find((movie) => movie.title === resultTitle) || {
        "title": resultTitle,
        "image": ""
      };

      const relatedCards = data.cards.filter((cardData) => cardData.movie === resultTitle);
      const quoteSource = relatedCards[Math.floor(Math.random() * Math.max(relatedCards.length, 1))] || data.cards[0];

      return {
        scores,
        maxScore,
        winners,
        resultTitle,
        resultMovie,
        quote: quoteSource ? quoteSource.quote : ""
      };
    }

    function renderResult(result, compatibility, datePlan) {
      const tieNote = result.winners.length > 1
        ? `<p class="tie-note">–ë—ã–ª–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∏–¥–µ—Ä–æ–≤ —Å ${result.maxScore} –æ—á–∫–∞–º–∏. –í—ã–±—Ä–∞–ª–∏ —Å–ª—É—á–∞–π–Ω–æ —Å—Ä–µ–¥–∏ –Ω–∏—Ö.</p>`
        : "";

      const movieLink = movieLinks[result.resultTitle];
      const linkHtml = movieLink
        ? `<a class="result-link" href="${escapeHtml(movieLink)}" target="_blank" rel="noopener noreferrer">–°–º–æ—Ç—Ä–µ—Ç—å —Ñ–∏–ª—å–º</a>`
        : "";

      const datePlanHtml = datePlan
        .map((line) => `<li>${escapeHtml(line)}</li>`)
        .join("");

      card.innerHTML = `
        <section class="card-inner screen-center">
          <p class="result-label">–ù–∞—à —Å —Ç–æ–±–æ–π —Ñ–∏–ª—å–º</p>
          ${renderMovieVisual(result.resultTitle, result.resultMovie.image, result.resultTitle, true)}
          <h2 class="result-title">${escapeHtml(result.resultTitle)}</h2>
          <blockquote class="result-quote">¬´${escapeHtml(result.quote)}¬ª</blockquote>
          ${tieNote}
          <section class="result-block">
            <h3 class="result-block-title">–ù–∞—Å–∫–æ–ª—å–∫–æ —Å–æ–≤–ø–∞–ª–∏ –º—ã —Å —Ç–æ–±–æ–π üíå</h3>
            <p class="compat-score">${compatibility.matches} –∏–∑ ${compatibility.total} (${compatibility.percent}%)</p>
            <p class="compat-text">${escapeHtml(compatibility.text)}</p>
          </section>
          <section class="result-block">
            <h3 class="result-block-title">–ù–∞—à–µ –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ ‚ú®</h3>
            <ol class="plan-list">${datePlanHtml}</ol>
          </section>
          ${linkHtml}
          <p class="result-note">–°–æ—Ö—Ä–∞–Ω–∏, —Å —Ç–µ–±—è –æ–±–µ—â–∞–Ω–∏–µ, —á—Ç–æ –º—ã –≤–º–µ—Å—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–∏–º —Ñ–∏–ª—å–º –∏ –Ω–∞–π–¥–µ–º —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç ‚ù§Ô∏è</p>
          <div class="result-links">
            <button id="restartBtn" class="text-link-btn" type="button">–ü—Ä–æ–π—Ç–∏ –µ—â—ë —Ä–∞–∑</button>
            <button id="saveCardBtn" class="text-link-btn" type="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –æ—Ç–∫—Ä—ã—Ç–∫—É</button>
          </div>
        </section>
      `;

      lastResultPayload = {
        result,
        compatibility,
        datePlan
      };

      card.scrollTop = 0;

      for (let i = 0; i < 24; i++) {
        setTimeout(spawnHeart, i * 60);
      }
    }

    function startQuiz() {
      currentCardIndex = 0;
      userAnswers = {};
      isTransitioning = false;
      lastResultPayload = null;
      renderQuestion(data.cards[currentCardIndex], currentCardIndex);

      for (let i = 0; i < 18; i++) {
        setTimeout(spawnHeart, i * 70);
      }
    }

    function onAnswerPicked(answerIndex) {
      const currentCard = data.cards[currentCardIndex];
      if (!currentCard || isTransitioning) return;

      userAnswers[currentCard.id] = answerIndex;
      const chosenAnswer = currentCard.answers[answerIndex];
      isTransitioning = true;
      renderAnswerMoment(chosenAnswer ? chosenAnswer.text : "");

      setTimeout(() => {
        if (currentCardIndex < data.cards.length - 1) {
          currentCardIndex += 1;
          renderQuestion(data.cards[currentCardIndex], currentCardIndex);
          isTransitioning = false;
          return;
        }

        const result = calculateResult();
        const compatibility = calculateCompatibility();
        const datePlan = buildDatePlan(result.resultTitle);
        renderResult(result, compatibility, datePlan);
        isTransitioning = false;
      }, 1300);
    }

    for (let i = 0; i < 14; i++) {
      setTimeout(spawnHeart, i * 140);
    }
    setInterval(spawnHeart, 320);

    card.addEventListener("click", (event) => {
      const noBtn = event.target.closest("#noBtn");
      if (noBtn) {
        event.preventDefault();
        return;
      }

      const yesBtn = event.target.closest("#yesBtn");
      if (yesBtn) {
        startQuiz();
        return;
      }

      const answerBtn = event.target.closest(".answer-btn");
      if (answerBtn) {
        const pickedIndex = Number(answerBtn.dataset.answerIndex);
        if (Number.isFinite(pickedIndex)) {
          onAnswerPicked(pickedIndex);
        }
        return;
      }

      const restartBtn = event.target.closest("#restartBtn");
      if (restartBtn) {
        renderIntro();
        return;
      }

      const saveCardBtn = event.target.closest("#saveCardBtn");
      if (saveCardBtn && lastResultPayload) {
        savePostcard(lastResultPayload);
      }
    });

    card.addEventListener("pointermove", (event) => {
      if (event.pointerType === "mouse" || event.pointerType === "pen") {
        moveNoAway(event.clientX, event.clientY);
      }
    });

    card.addEventListener("touchstart", (event) => {
      const touch = event.touches[0];
      if (touch) moveNoAway(touch.clientX, touch.clientY);
    }, { passive: true });

    card.addEventListener("touchmove", (event) => {
      const touch = event.touches[0];
      if (touch) moveNoAway(touch.clientX, touch.clientY);
    }, { passive: true });

    card.addEventListener("pointerleave", () => {
      setNoOffset(0, 0);
    });

    card.addEventListener("pointerdown", (event) => {
      const noBtn = event.target.closest("#noBtn");
      if (!noBtn) return;

      moveNoAway(event.clientX, event.clientY);
      event.preventDefault();
    });

    renderIntro();
  </script>
</body>
</html>
